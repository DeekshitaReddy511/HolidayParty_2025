<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rate Your Train Ride</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(180deg, #9dd9ff 0%, #c9f1ff 40%, #f4f7fb 100%);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 10px 8px;
            overflow-x: hidden;
            position: relative;
            min-height: 350px; /* fits iframe */
        }

        .widget-root {
            max-width: 460px;
            width: 100%;
            margin: 0 auto;
        }

        h1 {
            margin: 0 0 4px;
            font-size: 22px;
            text-align: center;
        }

        .subtitle {
            margin-bottom: 10px;
            color: #555;
            text-align: center;
            font-size: 12px;
            line-height: 1.4;
        }

        /* Background clouds */
        .sky-cloud {
            position: fixed;
            top: 8%;
            width: 90px;
            height: 45px;
            background: #ffffff;
            border-radius: 60px;
            box-shadow:
                24px 8px 0 0 #ffffff,
                48px 4px 0 0 #ffffff;
            opacity: 0.9;
            z-index: -1;
            animation: cloud-drift 40s linear infinite;
        }

        .sky-cloud.cloud2 {
            top: 20%;
            width: 110px;
            animation-duration: 55s;
            animation-delay: -10s;
            opacity: 0.8;
        }

        .sky-cloud.cloud3 {
            top: 32%;
            width: 80px;
            animation-duration: 35s;
            animation-delay: -20s;
            opacity: 0.7;
        }

        @keyframes cloud-drift {
            0%   { transform: translateX(-20vw); }
            100% { transform: translateX(120vw); }
        }

        /* Santa + sleigh */
        .santa {
            position: fixed;
            top: 16%;
            right: -25%;
            width: 120px;
            height: 40px;
            pointer-events: none;
            z-index: 0;
            animation: santa-fly 18s linear infinite;
        }

        @keyframes santa-fly {
            0%   { transform: translateX(0);   opacity: 0; }
            10%  { opacity: 1; }
            90%  { opacity: 1; }
            100% { transform: translateX(-80vw); opacity: 0; }
        }

        .santa-sleigh {
            position: absolute;
            right: 0;
            bottom: 6px;
            width: 40px;
            height: 14px;
            border-radius: 0 0 10px 10px;
            background: #b22222;
            box-shadow: 0 0 4px rgba(0,0,0,0.2);
        }

        .santa-sleigh::after {
            content: "";
            position: absolute;
            bottom: -4px;
            left: 4px;
            right: 4px;
            height: 3px;
            border-radius: 2px;
            background: #6b3a1d;
        }

        .santa-body {
            position: absolute;
            left: 4px;
            bottom: 10px;
            width: 14px;
            height: 16px;
            background: #e63946;
            border-radius: 6px 6px 4px 4px;
        }

        .santa-head {
            position: absolute;
            left: 6px;
            bottom: 24px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ffe0c2;
        }

        .santa-hat {
            position: absolute;
            left: 4px;
            bottom: 30px;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 2px solid transparent;
            border-bottom: 10px solid #e63946;
        }

        .santa-hat::after {
            content: "";
            position: absolute;
            right: -4px;
            bottom: -2px;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #fff;
        }

        .reindeer {
            position: absolute;
            right: 46px;
            bottom: 10px;
            width: 60px;
            height: 12px;
        }

        .reindeer::before,
        .reindeer::after {
            content: "";
            position: absolute;
            width: 14px;
            height: 10px;
            border-radius: 6px;
            background: #8b5a2b;
            box-shadow: 20px 0 0 #8b5a2b, 40px 0 0 #8b5a2b;
        }

        .reindeer-nose {
            position: absolute;
            left: -3px;
            top: 4px;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: #ff4b4b;
            box-shadow: 20px 0 0 #ffbe4b, 40px 0 0 #ff4b4b;
        }

        /* Ground */
        .ground {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(180deg, #76c26b 0%, #4e9e4a 100%);
            z-index: -1;
        }

        .bush {
            position: absolute;
            bottom: 18px;
            width: 50px;
            height: 24px;
            background: #3f8c3a;
            border-radius: 30px;
            box-shadow:
                16px 0 0 0 #3f8c3a,
                32px 0 0 0 #3f8c3a;
            opacity: 0.9;
        }

        .bush.b1 { left: 15%; }
        .bush.b2 { left: 45%; bottom: 22px; }
        .bush.b3 { left: 68%; }
        .bush.b4 { left: 82%; bottom: 24px; }

        /* CHRISTMAS TREES */
        .tree {
            position: absolute;
            bottom: 18px;
            width: 0;
            height: 0;
            border-left: 24px solid transparent;
            border-right: 24px solid transparent;
            border-bottom: 50px solid #1f7a3b;
        }

        .tree::before,
        .tree::after {
            content: "";
            position: absolute;
            left: -28px;
            border-left: 28px solid transparent;
            border-right: 28px solid transparent;
        }

        .tree::before {
            top: -22px;
            border-bottom: 46px solid #24924a;
        }

        .tree::after {
            top: -40px;
            border-bottom: 40px solid #2ca65b;
        }

        .tree-trunk {
            position: absolute;
            left: -6px;
            bottom: -12px;
            width: 12px;
            height: 12px;
            border-radius: 2px;
            background: #5a3c20;
        }

        .tree-lights {
            position: absolute;
            top: -4px;
            left: -20px;
            width: 40px;
            height: 36px;
            background:
                radial-gradient(circle, #ff4b4b 0 55%, transparent 60%) 4px 4px / 12px 12px repeat,
                radial-gradient(circle, #ffd93b 0 55%, transparent 60%) 0px 12px / 12px 12px repeat,
                radial-gradient(circle, #4be1ff 0 55%, transparent 60%) 8px 20px / 12px 12px repeat;
            opacity: 0.9;
            mix-blend-mode: screen;
            animation: tree-lights-blink 1.4s linear infinite;
        }

        @keyframes tree-lights-blink {
            0%   { opacity: 0.5; transform: translateY(0); }
            50%  { opacity: 1;   transform: translateY(-1px); }
            100% { opacity: 0.6; transform: translateY(0); }
        }

        .tree.t-left { left: 4%; transform: scale(0.9); }
        .tree.t-right { right: 4%; transform: scale(0.9); }

        .train-wrapper {
            margin: 6px 0 8px;
            position: relative;
            padding: 14px 18px 22px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.97);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            animation: gentle-bob 3s ease-in-out infinite;
        }

        @keyframes gentle-bob {
            0%   { transform: translateY(0); }
            50%  { transform: translateY(-2px); }
            100% { transform: translateY(0); }
        }

        /* Subtle light glow around the card */
        .train-wrapper::before {
            content: "";
            position: absolute;
            inset: 4px;
            border-radius: 18px;
            pointer-events: none;
            box-shadow:
                0 0 0 1px rgba(255, 255, 255, 0.7),
                0 0 16px 2px rgba(255, 215, 0, 0.2);
        }

        .train-track-container {
            position: relative;
        }

        .train {
            display: flex;
            align-items: flex-end;
            gap: 6px;
            position: relative;
            transition: transform 0.3s ease;
        }

        .train-shadow {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 22px;
            height: 8px;
            background: radial-gradient(ellipse at center,
                       rgba(0,0,0,0.15) 0,
                       rgba(0,0,0,0.0) 70%);
            pointer-events: none;
        }

        /* Train + carriages */
        .engine,
        .carriage {
            position: relative;
            width: 60px;
            height: 50px;
            border-radius: 14px;
            border: 2px solid #3a3a3a;
            cursor: pointer;
            background: #f0c95c;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
            overflow: hidden;
        }

        .engine {
            background: #ff6b6b;
        }

        .engine-top {
            position: absolute;
            top: -6px;
            left: 6px;
            right: 10px;
            height: 6px;
            border-radius: 7px 7px 3px 3px;
            background: #333;
        }

        .engine-window {
            position: absolute;
            top: 8px;
            left: 12px;
            width: 22px;
            height: 18px;
            border-radius: 5px;
            background: linear-gradient(180deg, #e5f4ff 0%, #c0e6ff 100%);
            border: 1px solid #2d4f6d;
        }

        .chimney {
            position: absolute;
            top: -14px;
            right: 8px;
            width: 9px;
            height: 20px;
            border-radius: 6px;
            background: #555;
        }

        .carriage {
            background: #ffb347;
        }

        .carriage[data-rating="1"] { background: #ff6b6b; }
        .carriage[data-rating="2"] { background: #ff9f6b; }
        .carriage[data-rating="3"] { background: #ffc857; }
        .carriage[data-rating="4"] { background: #f7e06b; }
        .carriage[data-rating="5"] { background: #8fd37a; }

        .carriage-window {
            position: absolute;
            top: 9px;
            left: 11px;
            right: 11px;
            height: 18px;
            border-radius: 5px;
            background: linear-gradient(180deg, #e5f4ff 0%, #c0e6ff 100%);
            border: 1px solid #2d4f6d;
        }

        .carriage::after {
            content: "";
            position: absolute;
            right: -6px;
            bottom: 7px;
            width: 12px;
            height: 4px;
            border-radius: 2px;
            background: #555;
        }

        .carriage:last-child::after {
            display: none;
        }

        .wheel-row {
            position: absolute;
            bottom: -8px;
            left: 9px;
            display: flex;
            gap: 8px;
        }

        .wheel {
            width: 14px;
            height: 14px;
            background: #222;
            border-radius: 50%;
            box-shadow: 0 1px 0 #000;
            animation: wheel-spin 0.9s linear infinite;
            transform-origin: center;
        }

        @keyframes wheel-spin {
            0%   { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .carriage.selected {
            transform: translateY(-5px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.22);
        }

        .carriage:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.18);
        }

        .engine:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.18);
        }

        /* Fairy lights on train */
        .fairy-lights {
            position: absolute;
            top: 4px;
            left: 8px;
            right: 8px;
            height: 5px;
            pointer-events: none;
        }

        .fairy-lights::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(circle, #ff4b4b 0 55%, transparent 60%),
                radial-gradient(circle, #ffd93b 0 55%, transparent 60%),
                radial-gradient(circle, #4be1ff 0 55%, transparent 60%),
                radial-gradient(circle, #9cff6b 0 55%, transparent 60%);
            background-size: 14px 5px, 14px 5px, 14px 5px, 14px 5px;
            background-position:
                0 0,
                4px 0,
                8px 0,
                12px 0;
            background-repeat: repeat-x;
            animation: light-chase 1.2s linear infinite;
            opacity: 0.95;
        }

        @keyframes light-chase {
            0%   { background-position-x: 0, 4px, 8px, 12px; }
            100% { background-position-x: -14px, -10px, -6px, -2px; }
        }

        .track {
            width: 380px;
            height: 6px;
            background: #555;
            border-radius: 4px;
            margin-top: 20px;
            position: relative;
        }

        .track::before {
            content: "";
            position: absolute;
            top: -3px;
            left: 0;
            right: 0;
            height: 2px;
            background: repeating-linear-gradient(
                to right,
                #333 0,
                #333 16px,
                #999 16px,
                #999 28px
            );
            opacity: 0.6;
        }

        /* Smoke */
        .smoke-stack {
            position: absolute;
            top: -22px;
            right: 11px;
            width: 0;
            height: 0;
        }

        .smoke-cloud {
            position: absolute;
            border-radius: 50%;
            background: rgba(120, 120, 120, 0.7);
            transition: transform 0.3s ease, opacity 0.3s ease;
            animation: smoke-puff 2s ease-in-out infinite;
        }

        @keyframes smoke-puff {
            0% {
                transform: translateY(0) scale(0.9);
                opacity: 0.4;
            }
            50% {
                transform: translateY(-10px) scale(1.05);
                opacity: 0.9;
            }
            100% {
                transform: translateY(-18px) scale(1.1);
                opacity: 0;
            }
        }

        .smoke-cloud.one {
            width: 14px;
            height: 14px;
            top: -6px;
            left: -4px;
            animation-delay: 0s;
        }

        .smoke-cloud.two {
            width: 18px;
            height: 18px;
            top: -18px;
            left: -8px;
            animation-delay: 0.3s;
        }

        .smoke-cloud.three {
            width: 22px;
            height: 22px;
            top: -32px;
            left: -12px;
            animation-delay: 0.6s;
        }

        .rating-1 .smoke-cloud { transform: scale(0.6); }
        .rating-2 .smoke-cloud { transform: scale(0.85); }
        .rating-3 .smoke-cloud { transform: scale(1); }
        .rating-4 .smoke-cloud { transform: scale(1.2); }
        .rating-5 .smoke-cloud { transform: scale(1.4); }

        .rating-text {
            margin-top: 4px;
            font-size: 12px;
            text-align: center;
        }

        .controls {
            margin-top: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        button {
            padding: 6px 14px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            background: linear-gradient(135deg, #007bff, #00b4ff);
            color: #fff;
            box-shadow: 0 3px 8px rgba(0,0,0,0.25);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.3);
        }

        button:disabled {
            background: #999;
            cursor: not-allowed;
            box-shadow: none;
        }

        .debug-note {
            margin-top: 4px;
            font-size: 10px;
            color: #777;
            text-align: center;
        }

        /* Hover tooltip */
        #hover-tooltip {
            position: fixed;
            padding: 6px 8px;
            background: #222;
            color: #fff;
            font-size: 11px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transform: translateY(-4px);
            transition: opacity 0.1s ease, transform 0.1s ease;
            max-width: 220px;
            z-index: 999;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        #hover-tooltip.visible {
            opacity: 1;
            transform: translateY(-8px);
        }
    </style>
</head>
<body>
    <!-- Clouds -->
    <div class="sky-cloud" style="left:-15%;"></div>
    <div class="sky-cloud cloud2" style="left:-30%;"></div>
    <div class="sky-cloud cloud3" style="left:-25%;"></div>

    <!-- Santa flyover -->
    <div class="santa">
        <div class="santa-sleigh">
            <div class="santa-body"></div>
            <div class="santa-head"></div>
            <div class="santa-hat"></div>
        </div>
        <div class="reindeer">
            <div class="reindeer-nose"></div>
        </div>
    </div>

    <!-- Ground area -->
    <div class="ground">
        <div class="bush b1"></div>
        <div class="bush b2"></div>
        <div class="bush b3"></div>
        <div class="bush b4"></div>

        <!-- Christmas trees -->
        <div class="tree t-left">
            <div class="tree-trunk"></div>
            <div class="tree-lights"></div>
        </div>
        <div class="tree t-right">
            <div class="tree-trunk"></div>
            <div class="tree-lights"></div>
        </div>
    </div>

    <div class="widget-root">
        <h1>Rate Your Train Ride</h1>
        <div class="subtitle">
            Move your mouse over the train and click a carriage (1â€“5).<br />
            The sky is calm. The train is not.
        </div>

        <div class="train-wrapper">
            <div class="train-track-container">
                <div class="train-shadow"></div>

                <div id="train" class="train rating-0">
                    <!-- Engine -->
                    <div class="engine">
                        <div class="engine-top"></div>
                        <div class="engine-window"></div>
                        <div class="chimney"></div>
                        <div class="smoke-stack">
                            <div class="smoke-cloud one"></div>
                            <div class="smoke-cloud two"></div>
                            <div class="smoke-cloud three"></div>
                        </div>
                        <div class="fairy-lights"></div>
                        <div class="wheel-row">
                            <div class="wheel"></div>
                            <div class="wheel"></div>
                        </div>
                    </div>

                    <!-- 5 clickable carriages = ratings 1â€“5 -->
                    <div class="carriage" data-rating="1">
                        <div class="carriage-window"></div>
                        <div class="fairy-lights"></div>
                        <div class="wheel-row">
                            <div class="wheel"></div>
                            <div class="wheel"></div>
                        </div>
                    </div>
                    <div class="carriage" data-rating="2">
                        <div class="carriage-window"></div>
                        <div class="fairy-lights"></div>
                        <div class="wheel-row">
                            <div class="wheel"></div>
                            <div class="wheel"></div>
                        </div>
                    </div>
                    <div class="carriage" data-rating="3">
                        <div class="carriage-window"></div>
                        <div class="fairy-lights"></div>
                        <div class="wheel-row">
                            <div class="wheel"></div>
                            <div class="wheel"></div>
                        </div>
                    </div>
                    <div class="carriage" data-rating="4">
                        <div class="carriage-window"></div>
                        <div class="fairy-lights"></div>
                        <div class="wheel-row">
                            <div class="wheel"></div>
                            <div class="wheel"></div>
                        </div>
                    </div>
                    <div class="carriage" data-rating="5">
                        <div class="carriage-window"></div>
                        <div class="fairy-lights"></div>
                        <div class="wheel-row">
                            <div class="wheel"></div>
                            <div class="wheel"></div>
                        </div>
                    </div>
                </div>

                <div class="track"></div>
            </div>
        </div>

        <div class="controls">
            <div class="rating-text">
                Selected rating:
                <strong id="selected-rating">None</strong> (out of 5)
            </div>
            <button id="submit-btn" disabled>Submit Rating</button>
        </div>

        <div class="debug-note">
            Warning: side effects may include guilt, laughter, and sudden empathy for trains.
        </div>
    </div>

    <div id="hover-tooltip"></div>

    <script>
        const trainEl = document.getElementById("train");
        const carriages = document.querySelectorAll(".carriage");
        const selectedRatingEl = document.getElementById("selected-rating");
        const submitBtn = document.getElementById("submit-btn");
        const hoverTooltip = document.getElementById("hover-tooltip");

        let selectedRating = null;
        let teaseClickCount = 0;  // number of dodges since last accepted rating
        let currentOffsetX = 0;   // current X position of train

        const commentsByRating = {
            1: "You've rated us a 1. An emergency meeting with the entire transit operations team has been scheduled. Please click 'OK' to begin the termination process for the train driver.",
            2: "A 2 star review means we are performing 40% below goal. Our metrics team is spiraling. Is your personal satisfaction worth destroying the morale of an entire department? Rethink this immediately.",
            3: "Ah, a 3. The mark of utter indifference. We will log this as 'Not Bad Enough to Fix.' Are you sure you don't have enough energy for just one more star? It requires minimal effort.",
            4: "FOUR stars is only 96% satisfaction! That small gap suggests a lack of alignment with our core brand values. Please detail the exact coordinates of the missing star before we can accept this submission.",
            5: "Perfect! Thank you. Now, to validate this 5-star rating, please complete a brief survey detailing 10 ways we can maintain this level of perfection forever. (This is mandatory, not optional.)"
        };

        const hoverCommentsByRating = {
            1: "1 star? The train just stalled emotionally.",
            2: "2 stars: minor derailment of happiness.",
            3: "3 stars: meh. The train shrugs.",
            4: "4 stars: so close the conductor can taste it.",
            5: "5 stars: the train is adding you to its will."
        };

        function updateSelection(rating) {
            selectedRating = rating;
            selectedRatingEl.textContent = rating;
            submitBtn.disabled = false;

            carriages.forEach(c => {
                const value = parseInt(c.getAttribute("data-rating"), 10);
                if (value === rating) c.classList.add("selected");
                else c.classList.remove("selected");
            });

            trainEl.className = "train rating-" + rating;
        }

        function moveTrainToRating(rating) {
            const ratingOffsets = {
                1: -50,
                2: -25,
                3: 0,
                4: 25,
                5: 50
            };
            const x = ratingOffsets[rating] || 0;
            currentOffsetX = x;
            trainEl.style.transform = `translate(${x}px, 0px) rotate(0deg)`;
        }

        function moveTrainDodge() {
            const possibleOffsets = [-110, -70, -30, 20, 60, 100];
            let bestOffset = possibleOffsets[0];
            let bestDist = Math.abs(bestOffset - currentOffsetX);

            possibleOffsets.forEach(off => {
                const dist = Math.abs(off - currentOffsetX);
                if (dist > bestDist + 10) {
                    bestDist = dist;
                    bestOffset = off;
                }
            });

            currentOffsetX = bestOffset;
            const angle = (Math.random() * 14 - 7);
            const y = (Math.random() * 10 - 5);

            trainEl.style.transform = `translate(${currentOffsetX}px, ${y}px) rotate(${angle}deg)`;
        }

        carriages.forEach(c => {
            c.addEventListener("click", () => {
                const rating = parseInt(c.getAttribute("data-rating"), 10);

                if (teaseClickCount < 3) {
                    teaseClickCount += 1;
                    moveTrainDodge();

                    hoverTooltip.textContent = `Attempt ${teaseClickCount}/3: The train has fled. Chase it!`;
                    hoverTooltip.classList.add("visible");

                    const rect = trainEl.getBoundingClientRect();
                    hoverTooltip.style.left = rect.left + rect.width / 2 + "px";
                    hoverTooltip.style.top = rect.top - 20 + "px";

                    setTimeout(() => hoverTooltip.classList.remove("visible"), 900);
                    return;
                }

                // 4th click: accept rating
                teaseClickCount = 0;
                updateSelection(rating);
                moveTrainToRating(rating);
            });

            c.addEventListener("mouseenter", (e) => {
                const rating = parseInt(c.getAttribute("data-rating"), 10);
                hoverTooltip.textContent = hoverCommentsByRating[rating];
                hoverTooltip.classList.add("visible");
                hoverTooltip.style.left = (e.clientX + 12) + "px";
                hoverTooltip.style.top = (e.clientY - 12) + "px";
            });

            c.addEventListener("mousemove", (e) => {
                hoverTooltip.style.left = (e.clientX + 12) + "px";
                hoverTooltip.style.top = (e.clientY - 12) + "px";
            });

            c.addEventListener("mouseleave", () => {
                hoverTooltip.classList.remove("visible");
            });
        });

        submitBtn.addEventListener("click", () => {
            if (!selectedRating) {
                alert("Please pick a rating first! The train needs to escape you 3 times before it cooperates ðŸ˜ˆ");
                return;
            }

            const message = commentsByRating[selectedRating];
            const confirmed = confirm(
                message + "\n\nClick OK to lock in this rating, or Cancel to reconsider your life choices."
            );

            if (!confirmed) return;

            alert("Thanks! You successfully gave a " + selectedRating +
                "-star ride. The train will never forgive you.");
        });
    </script>
</body>
</html>




