<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rate Your Holiday Ride</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(180deg, #9dd9ff 0%, #c9f1ff 40%, #f4f7fb 100%);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 10px 8px;
            overflow-x: hidden;
            position: relative;
            min-height: 350px; /* fits iframe */
        }

        .widget-root {
            max-width: 460px;
            width: 100%;
            margin: 0 auto;
        }

        h1 {
            margin: 0 0 4px;
            font-size: 22px;
            text-align: center;
        }

        .subtitle {
            margin-bottom: 10px;
            color: #555;
            text-align: center;
            font-size: 12px;
            line-height: 1.4;
        }

        /* Clouds */
        .sky-cloud {
            position: fixed;
            top: 8%;
            width: 90px;
            height: 45px;
            background: #ffffff;
            border-radius: 60px;
            box-shadow:
                24px 8px 0 0 #ffffff,
                48px 4px 0 0 #ffffff;
            opacity: 0.9;
            z-index: -1;
            animation: cloud-drift 40s linear infinite;
        }
        .sky-cloud.cloud2 {
            top: 20%;
            width: 110px;
            animation-duration: 55s;
            animation-delay: -10s;
            opacity: 0.8;
        }
        .sky-cloud.cloud3 {
            top: 32%;
            width: 80px;
            animation-duration: 35s;
            animation-delay: -20s;
            opacity: 0.7;
        }
        @keyframes cloud-drift {
            0%   { transform: translateX(-20vw); }
            100% { transform: translateX(120vw); }
        }

        /* === EXTRA CHRISTMAS BACKGROUND === */

        /* Falling snow */
        .snow {
            position: fixed;
            inset: 0;
            pointer-events: none;
            background-image:
                radial-gradient(circle, rgba(255,255,255,0.8) 0 2px, transparent 3px),
                radial-gradient(circle, rgba(255,255,255,0.6) 0 2px, transparent 3px);
            background-size: 18px 18px, 26px 26px;
            background-position: 0 0, 10px -10px;
            opacity: 0.6;
            mix-blend-mode: screen;
            animation: snow-fall 7s linear infinite;
            z-index: 0;
        }
        @keyframes snow-fall {
            0%   { background-position: 0 -40px, 10px -80px; }
            100% { background-position: 0 40px, 10px 80px; }
        }

        /* Garland of lights across top */
        .top-lights {
            position: fixed;
            top: -12px;            /* fully above title */
            left: 0;
            right: 0;
            height: 12px;
            pointer-events: none;
            z-index: 2;
        }
        .top-lights::before {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            top: 10px;
            height: 1.5px;
            background: #3a4b63;
            opacity: 0.8;
        }
        .top-lights::after {
            content: "";
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(circle, #ff4b4b 0 55%, transparent 60%),
                radial-gradient(circle, #ffd93b 0 55%, transparent 60%),
                radial-gradient(circle, #4be1ff 0 55%, transparent 60%),
                radial-gradient(circle, #9b5de5 0 55%, transparent 60%);
            background-size: 14px 14px;
            background-position: 0 6px, 4px 6px, 8px 6px, 12px 6px;
            background-repeat: repeat-x;
            animation: garland-blink 1.5s linear infinite;
        }
        @keyframes garland-blink {
            0%   { opacity: 0.5; transform: translateY(0); }
            50%  { opacity: 1;   transform: translateY(1px); }
            100% { opacity: 0.5; transform: translateY(0); }
        }

        /* === SANTA FLYOVER === */
        .santa {
            position: fixed;
            top: 11%;
            right: -30%;
            width: 130px;
            height: 40px;
            pointer-events: none;
            z-index: 0;
            animation: santa-fly 18s linear infinite;
        }
        @keyframes santa-fly {
            0%   { transform: translateX(0); opacity: 0; }
            10%  { opacity: 1; }
            90%  { opacity: 1; }
            100% { transform: translateX(-90vw); opacity: 0; }
        }

        .santa-sleigh {
            position: absolute;
            right: 0;
            bottom: 6px;
            width: 42px;
            height: 15px;
            border-radius: 0 0 12px 12px;
            background: #b22222;
            box-shadow: 0 0 4px rgba(0,0,0,0.25);
        }
        .santa-sleigh::after {
            content: "";
            position: absolute;
            bottom: -4px;
            left: 4px;
            right: 4px;
            height: 3px;
            border-radius: 2px;
            background: #6b3a1d;
        }

        .santa-body {
            position: absolute;
            left: 6px;
            bottom: 10px;
            width: 16px;
            height: 16px;
            background: #e63946;
            border-radius: 6px 6px 4px 4px;
        }
        .santa-head {
            position: absolute;
            left: 9px;
            bottom: 24px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ffe0c2;
        }
        .santa-hat {
            position: absolute;
            left: 7px;
            bottom: 31px;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 3px solid transparent;
            border-bottom: 10px solid #e63946;
        }
        .santa-hat::after {
            content: "";
            position: absolute;
            right: -4px;
            bottom: -2px;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #fff;
        }

        .reindeer {
            position: absolute;
            right: 46px;
            bottom: 10px;
            width: 70px;
            height: 14px;
        }
        .reindeer-body {
            position: absolute;
            width: 16px;
            height: 12px;
            border-radius: 6px;
            background: #8b5a2b;
            box-shadow: 22px 0 0 #8b5a2b, 44px 0 0 #8b5a2b;
        }
        .reindeer-nose {
            position: absolute;
            left: -4px;
            top: 4px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #ff4b4b;
            box-shadow: 22px 0 0 #ffd93b, 44px 0 0 #ff4b4b;
        }

        /* Ground */
        .ground {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(180deg, #76c26b 0%, #4e9e4a 100%);
            z-index: -1;
        }

        .bush {
            position: absolute;
            bottom: 18px;
            width: 60px;
            height: 26px;
            background: #3f8c3a;
            border-radius: 30px;
            box-shadow:
                18px 0 0 0 #3f8c3a,
                36px 0 0 0 #3f8c3a;
            opacity: 0.9;
        }
        .bush.b1 { left: 16%; }
        .bush.b2 { left: 44%; bottom: 22px; }
        .bush.b3 { left: 70%; }
        .bush.b4 { left: 84%; bottom: 24px; }

        /* Christmas trees */
        .tree {
            position: absolute;
            bottom: 18px;
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 38px solid #1f7a3b;
        }
        .tree::before {
            content: "";
            position: absolute;
            left: -18px;
            top: -20px;
            border-left: 18px solid transparent;
            border-right: 18px solid transparent;
            border-bottom: 30px solid #24924a;
        }
        .tree-trunk {
            position: absolute;
            left: -5px;
            bottom: -10px;
            width: 10px;
            height: 10px;
            background: #5a3c20;
            border-radius: 2px;
        }

        .tree-lights {
            position: absolute;
            top: -12px;
            left: -18px;
            width: 36px;
            height: 34px;
            background:
                radial-gradient(circle, #ff4b4b 0 55%, transparent 60%) 4px 4px/10px 10px repeat,
                radial-gradient(circle, #ffd93b 0 55%, transparent 60%) 0px 14px/10px 10px repeat,
                radial-gradient(circle, #4be1ff 0 55%, transparent 60%) 8px 22px/10px 10px repeat;
            mix-blend-mode: screen;
            opacity: 0.8;
            animation: tree-blink 1.4s linear infinite;
        }
        .tree-star {
            position: absolute;
            top: -32px;
            left: -6px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: radial-gradient(circle, #ffd86b 0, #f3b136 60%, #c28c1a 100%);
            box-shadow: 0 0 6px rgba(255, 230, 150, 0.9);
        }
        .tree.t-left { left: 8%; transform: scale(0.95); }
        .tree.t-right { right: 8%; transform: scale(0.95); }

        @keyframes tree-blink {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        /* Presents & candy canes on ground */
        .present {
            position: absolute;
            bottom: 18px;
            width: 18px;
            height: 18px;
            border-radius: 3px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.25);
        }
        .present::before,
        .present::after {
            content: "";
            position: absolute;
            background: rgba(255,255,255,0.8);
        }
        .present::before {
            width: 4px;
            top: 0;
            bottom: 0;
            left: 7px;
        }
        .present::after {
            height: 4px;
            left: 0;
            right: 0;
            top: 7px;
        }
        .present.p1 { left: 10%; background: #ff6b6b; }
        .present.p2 { left: 32%; background: #ffd93b; }
        .present.p3 { right: 18%; background: #4be1ff; }

        .candy-cane {
            position: absolute;
            bottom: 22px;
            width: 10px;
            height: 26px;
            border-radius: 5px 5px 0 0;
            background:
                repeating-linear-gradient(
                    45deg,
                    #ff4b4b 0 4px,
                    #ffffff 4px 8px
                );
        }
        .candy-cane::after {
            content: "";
            position: absolute;
            top: -6px;
            left: 0;
            width: 14px;
            height: 10px;
            border-radius: 8px 8px 0 0;
            border-top: 4px solid transparent;
            border-left: 4px solid transparent;
            background:
                repeating-linear-gradient(
                    45deg,
                    #ff4b4b 0 4px,
                    #ffffff 4px 8px
                );
        }
        .candy-cane.c1 { left: 22%; }
        .candy-cane.c2 { right: 26%; }

        .train-wrapper {
            margin: 6px 0 8px;
            position: relative;
            padding: 14px 18px 22px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.97);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            animation: gentle-bob 3s ease-in-out infinite;
        }
        @keyframes gentle-bob {
            0%   { transform: translateY(0); }
            50%  { transform: translateY(-2px); }
            100% { transform: translateY(0); }
        }

        .train-track-container {
            position: relative;
        }

        .train {
            display: flex;
            align-items: flex-end;
            gap: 6px;
            position: relative;
            transition: transform 0.3s ease;
            z-index: 1;
        }

        .train-shadow {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 22px;
            height: 8px;
            background: radial-gradient(ellipse at center,
                rgba(0,0,0,0.15) 0,
                rgba(0,0,0,0.0) 70%);
            pointer-events: none;
        }

        /* Engine & carriages */
        .engine,
        .carriage {
            position: relative;
            width: 60px;
            height: 50px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .engine {
            border-radius: 14px;
            border: 2px solid #3a3a3a;
            background: #ff6b6b;
        }

        .engine-roof {
            position: absolute;
            top: -6px;
            left: 8px;
            right: 10px;
            height: 10px;
            border-radius: 10px 10px 4px 4px;
            background: #444;
        }

        .engine-window {
            position: absolute;
            top: 10px;
            left: 12px;
            width: 22px;
            height: 18px;
            border-radius: 5px;
            background: #ffffff;
            border: 1px solid #ccc;
        }

        .chimney {
            position: absolute;
            top: -18px;
            right: 10px;
            width: 10px;
            height: 26px;
            border-radius: 8px;
            background: #555;
        }

        /* Sleigh-style carriages */
        .carriage {
            background: transparent;
            border: none;
            width: 70px;
            height: 55px;
        }

        .sleigh-body {
            position: absolute;
            bottom: 6px;
            left: 4px;
            right: 6px;
            height: 24px;
            border-radius: 10px 18px 2px 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .sleigh-edge {
            position: absolute;
            bottom: 4px;
            left: 6px;
            right: 8px;
            height: 4px;
            border-radius: 6px;
            background: rgba(255,255,255,0.3);
            opacity: 0.9;
        }

        .sleigh-rail {
            position: absolute;
            bottom: 0;
            left: 4px;
            right: 4px;
            height: 4px;
            border-radius: 3px;
            background: #b5652a;
            box-shadow: 0 0 0 2px #84401a;
        }
        .sleigh-rail::before,
        .sleigh-rail::after {
            content: "";
            position: absolute;
            bottom: -4px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 3px solid #84401a;
            border-top-color: transparent;
            border-left-color: transparent;
            background: #b5652a;
        }
        .sleigh-rail::before { left: 4px; transform: rotate(-40deg); }
        .sleigh-rail::after  { right: 4px; transform: rotate(-10deg); }

        .gift {
            position: absolute;
            bottom: 24px;
            width: 14px;
            height: 16px;
            border-radius: 3px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        .gift::before,
        .gift::after {
            content: "";
            position: absolute;
            background: rgba(255,255,255,0.8);
        }
        .gift::before {
            width: 3px;
            left: 5px;
            top: 0;
            bottom: 0;
        }
        .gift::after {
            height: 3px;
            left: 0;
            right: 0;
            top: 6px;
        }

        .gift1 { left: 10px; }
        .gift2 { left: 28px; transform: scale(0.9); }
        .gift3 { right: 12px; transform: scale(0.95); }

        /* Color per rating */
        .carriage[data-rating="1"] .sleigh-body { background: #ff5c5c; }
        .carriage[data-rating="2"] .sleigh-body { background: #ff9f6b; }
        .carriage[data-rating="3"] .sleigh-body { background: #ffc857; }
        .carriage[data-rating="4"] .sleigh-body { background: #ffe28a; }
        .carriage[data-rating="5"] .sleigh-body { background: #a5e27a; }

        .carriage[data-rating="1"] .gift1 { background: #ffd93b; }
        .carriage[data-rating="1"] .gift2 { background: #4be1ff; }
        .carriage[data-rating="1"] .gift3 { background: #9b5de5; }

        .carriage[data-rating="2"] .gift1 { background: #4be1ff; }
        .carriage[data-rating="2"] .gift2 { background: #ffd93b; }
        .carriage[data-rating="2"] .gift3 { background: #ff6b6b; }

        .carriage[data-rating="3"] .gift1 { background: #9b5de5; }
        .carriage[data-rating="3"] .gift2 { background: #ffd93b; }
        .carriage[data-rating="3"] .gift3 { background: #4be1ff; }

        .carriage[data-rating="4"] .gift1 { background: #ff6b6b; }
        .carriage[data-rating="4"] .gift2 { background: #a5e27a; }
        .carriage[data-rating="4"] .gift3 { background: #ffd93b; }

        .carriage[data-rating="5"] .gift1 { background: #ffd93b; }
        .carriage[data-rating="5"] .gift2 { background: #4be1ff; }
        .carriage[data-rating="5"] .gift3 { background: #ff6b6b; }

        .fairy-lights {
            position: absolute;
            top: 6px;
            left: 8px;
            right: 8px;
            height: 4px;
            pointer-events: none;
        }
        .fairy-lights::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(circle, #ff4b4b 0 55%, transparent 60%),
                radial-gradient(circle, #ffd93b 0 55%, transparent 60%),
                radial-gradient(circle, #4be1ff 0 55%, transparent 60%);
            background-size: 14px 4px, 14px 4px, 14px 4px;
            background-position: 0 0, 5px 0, 10px 0;
            background-repeat: repeat-x;
            opacity: 0.8;
            animation: light-chase 1.3s linear infinite;
        }
        @keyframes light-chase {
            0%   { background-position-x: 0, 5px, 10px; }
            100% { background-position-x: -14px, -9px, -4px; }
        }

        .carriage.selected {
            transform: translateY(-5px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.22);
        }
        .carriage:hover,
        .engine:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.18);
        }

        .track {
            width: 380px;
            height: 6px;
            background: #555;
            border-radius: 4px;
            margin-top: 20px;
            position: relative;
        }
        .track::before {
            content: "";
            position: absolute;
            top: -3px;
            left: 0;
            right: 0;
            height: 2px;
            background: repeating-linear-gradient(
                to right,
                #333 0,
                #333 16px,
                #999 16px,
                #999 28px
            );
            opacity: 0.6;
        }

        /* Smoke */
        .smoke-stack {
            position: absolute;
            top: -22px;
            right: 12px;
            width: 0;
            height: 0;
            z-index: 2;
        }
        .smoke-cloud {
            position: absolute;
            border-radius: 50%;
            background: rgba(220,220,220,0.9);
            animation: smoke-puff 2s ease-in-out infinite;
        }
        .smoke-cloud.one {
            width: 14px;
            height: 14px;
            top: -4px;
            left: -6px;
            animation-delay: 0s;
        }
        .smoke-cloud.two {
            width: 18px;
            height: 18px;
            top: -20px;
            left: -10px;
            animation-delay: 0.3s;
        }
        .smoke-cloud.three {
            width: 22px;
            height: 22px;
            top: -36px;
            left: -14px;
            animation-delay: 0.6s;
        }
        @keyframes smoke-puff {
            0% {
                transform: translateY(4px) scale(0.7);
                opacity: 0;
            }
            30% { opacity: 0.6; }
            70% {
                transform: translateY(-14px) scale(1);
                opacity: 0.9;
            }
            100% {
                transform: translateY(-24px) scale(1.1);
                opacity: 0;
            }
        }

        .rating-text {
            margin-top: 4px;
            font-size: 12px;
            text-align: center;
        }

        .controls {
            margin-top: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        button {
            padding: 6px 14px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            background: linear-gradient(135deg, #007bff, #00b4ff);
            color: #fff;
            box-shadow: 0 3px 8px rgba(0,0,0,0.25);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }
        button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.3);
        }
        button:disabled {
            background: #999;
            cursor: not-allowed;
            box-shadow: none;
        }

        .debug-note {
            margin-top: 4px;
            font-size: 10px;
            color: #777;
            text-align: center;
        }

        /* Tooltip */
        #hover-tooltip {
            position: fixed;
            padding: 6px 8px;
            background: #222;
            color: #fff;
            font-size: 11px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transform: translateY(-4px);
            transition: opacity 0.1s ease, transform 0.1s ease;
            max-width: 220px;
            z-index: 999;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        #hover-tooltip.visible {
            opacity: 1;
            transform: translateY(-8px);
        }

        /* === NAUGHTY / NICE SLIDER GATE === */
        .naughty-nice-gate {
            margin: 4px 0 8px;
            font-size: 11px;
            color: #444;
        }
        .naughty-nice-gate .nn-label-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2px;
        }
        .naughty-nice-gate .nn-label-row span {
            flex: 1;
        }
        .naughty-nice-gate .nn-label-row span:last-child {
            text-align: right;
        }
        .nn-slider {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 2px;
        }
        .naughty-nice-gate input[type="range"] {
            width: 80%;
            -webkit-appearance: none;
            height: 4px;
            border-radius: 999px;
            background: linear-gradient(90deg, #c0392b, #f1c40f, #2ecc71);
            outline: none;
        }
        .naughty-nice-gate input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid #2c3e50;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        .naughty-nice-gate input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid #2c3e50;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        .nn-status {
            text-align: center;
            font-size: 11px;
            color: #555;
        }

        /* === POPUP ROBOT CHECK + GIFT CAPTCHA === */
        .captcha-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 900;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.18s ease;
        }
        .captcha-backdrop.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .captcha-card {
            width: 260px;
            border-radius: 14px;
            background: #ffffff;
            box-shadow: 0 6px 18px rgba(0,0,0,0.35);
            padding: 10px 12px 10px;
            font-size: 11px;
        }
        .captcha-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
        }
        .captcha-header input[type="checkbox"] {
            cursor: pointer;
            transform: scale(0.95);
        }
        .captcha-header label {
            cursor: pointer;
        }
        .captcha-body {
            border-top: 1px solid #eee;
            padding-top: 6px;
        }
        .captcha-title {
            font-weight: bold;
            margin-bottom: 4px;
        }
        .captcha-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 4px;
            margin-bottom: 4px;
        }
        .captcha-tile {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: 1px solid #ddd;
            background: #ffffff;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease, box-shadow 0.1s ease, border-color 0.1s ease;
        }
        .captcha-tile.selected {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border-color: #2ecc71;
        }
        .captcha-message {
            min-height: 14px;
        }
        .captcha-actions {
            margin-top: 4px;
            display: flex;
            justify-content: flex-end;
        }
        .captcha-actions button {
            padding: 4px 10px;
            font-size: 10px;
            box-shadow: none;
        }
    </style>
</head>
<body>
    <!-- Clouds -->
    <div class="sky-cloud" style="left:-15%;"></div>
    <div class="sky-cloud cloud2" style="left:-30%;"></div>
    <div class="sky-cloud cloud3" style="left:-25%;"></div>

    <!-- Snow + top lights -->
    <div class="snow"></div>
    <div class="top-lights"></div>

    <!-- Santa + reindeer -->
    <div class="santa">
        <div class="santa-sleigh">
            <div class="santa-body"></div>
            <div class="santa-head"></div>
            <div class="santa-hat"></div>
        </div>
        <div class="reindeer">
            <div class="reindeer-body"></div>
            <div class="reindeer-nose"></div>
        </div>
    </div>

    <!-- Ground + trees + presents + candy canes -->
    <div class="ground">
        <div class="bush b1"></div>
        <div class="bush b2"></div>
        <div class="bush b3"></div>
        <div class="bush b4"></div>

        <div class="tree t-left">
            <div class="tree-trunk"></div>
            <div class="tree-lights"></div>
            <div class="tree-star"></div>
        </div>
        <div class="tree t-right">
            <div class="tree-trunk"></div>
            <div class="tree-lights"></div>
            <div class="tree-star"></div>
        </div>

        <div class="present p1"></div>
        <div class="present p2"></div>
        <div class="present p3"></div>

        <div class="candy-cane c1"></div>
        <div class="candy-cane c2"></div>
    </div>

    <div class="widget-root">
        <h1>Rate Your Holiday Ride</h1>
        <div class="subtitle">
            If you have Been Nice! then Move your mouse over the train and click a sleigh (1‚Äì5).<br />
            The sky is calm. The train is not.
        </div>

        <!-- Naughty / Nice gate -->
        <div class="naughty-nice-gate">
            <div class="nn-label-row">
                <span>‚ùÑÔ∏è Naughty</span>
                <span>Nice ‚≠ê</span>
            </div>
            <div class="nn-slider">
                <input type="range" id="nn-slider" min="0" max="100" value="20" />
            </div>
            <div class="nn-status" id="nn-status">
                Slide to ‚ÄúNice‚Äù to unlock the train.
            </div>
        </div>

        <div class="train-wrapper">
            <div class="train-track-container">
                <div class="train-shadow"></div>

                <div id="train" class="train rating-0">
                    <!-- Engine -->
                    <div class="engine">
                        <div class="engine-roof"></div>
                        <div class="engine-window"></div>
                        <div class="chimney"></div>
                        <div class="smoke-stack">
                            <div class="smoke-cloud one"></div>
                            <div class="smoke-cloud two"></div>
                            <div class="smoke-cloud three"></div>
                        </div>
                        <div class="fairy-lights"></div>
                        <div class="wheel-row">
                            <div class="wheel"></div>
                            <div class="wheel"></div>
                        </div>
                    </div>

                    <!-- Sleigh carriages 1‚Äì5 -->
                    <div class="carriage" data-rating="1">
                        <div class="sleigh-body"></div>
                        <div class="sleigh-edge"></div>
                        <div class="sleigh-rail"></div>
                        <div class="gift gift1"></div>
                        <div class="gift gift2"></div>
                        <div class="gift gift3"></div>
                        <div class="fairy-lights"></div>
                    </div>
                    <div class="carriage" data-rating="2">
                        <div class="sleigh-body"></div>
                        <div class="sleigh-edge"></div>
                        <div class="sleigh-rail"></div>
                        <div class="gift gift1"></div>
                        <div class="gift gift2"></div>
                        <div class="gift gift3"></div>
                        <div class="fairy-lights"></div>
                    </div>
                    <div class="carriage" data-rating="3">
                        <div class="sleigh-body"></div>
                        <div class="sleigh-edge"></div>
                        <div class="sleigh-rail"></div>
                        <div class="gift gift1"></div>
                        <div class="gift gift2"></div>
                        <div class="gift gift3"></div>
                        <div class="fairy-lights"></div>
                    </div>
                    <div class="carriage" data-rating="4">
                        <div class="sleigh-body"></div>
                        <div class="sleigh-edge"></div>
                        <div class="sleigh-rail"></div>
                        <div class="gift gift1"></div>
                        <div class="gift gift2"></div>
                        <div class="gift gift3"></div>
                        <div class="fairy-lights"></div>
                    </div>
                    <div class="carriage" data-rating="5">
                        <div class="sleigh-body"></div>
                        <div class="sleigh-edge"></div>
                        <div class="sleigh-rail"></div>
                        <div class="gift gift1"></div>
                        <div class="gift gift2"></div>
                        <div class="gift gift3"></div>
                        <div class="fairy-lights"></div>
                    </div>
                </div>

                <div class="track"></div>
            </div>
        </div>

        <div class="controls">
            <div class="rating-text">
                Selected rating:
                <strong id="selected-rating">None</strong> (out of 5)
            </div>
            <button id="submit-btn" disabled>Submit Rating</button>
        </div>

        <div class="debug-note">
            Warning: side effects may include guilt, laughter, and sudden empathy for trains.
        </div>
    </div>

    <!-- Hover tooltip -->
    <div id="hover-tooltip"></div>

    <!-- POPUP CAPTCHA -->
    <div id="captcha-modal" class="captcha-backdrop">
        <div class="captcha-card">
            <div class="captcha-header">
                <input type="checkbox" id="robot-checkbox" />
                <label for="robot-checkbox">I'm not a robot</label>
            </div>
            <div class="captcha-body">
                <div class="captcha-title">Select all gifts to verify:</div>
                <div class="captcha-grid">
                    <!-- 4 gifts, 2 impostors -->
                    <button class="captcha-tile" data-type="gift">üéÅ</button>
                    <button class="captcha-tile" data-type="gift">üéÅ</button>
                    <button class="captcha-tile" data-type="not-gift">‚õÑ</button>
                    <button class="captcha-tile" data-type="gift">üéÅ</button>
                    <button class="captcha-tile" data-type="not-gift">üéÑ</button>
                    <button class="captcha-tile" data-type="gift">üéÅ</button>
                </div>
                <div class="captcha-message" id="captcha-message">
                    Tip: only click the presents, not the snowmen or trees.
                </div>
                <div class="captcha-actions">
                    <button id="captcha-done-btn">Done</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const trainEl = document.getElementById("train");
        const carriages = document.querySelectorAll(".carriage");
        const selectedRatingEl = document.getElementById("selected-rating");
        const submitBtn = document.getElementById("submit-btn");
        const hoverTooltip = document.getElementById("hover-tooltip");

        const captchaModal = document.getElementById("captcha-modal");
        const robotCheckbox = document.getElementById("robot-checkbox");
        const captchaTiles = document.querySelectorAll(".captcha-tile");
        const captchaMessage = document.getElementById("captcha-message");
        const captchaDoneBtn = document.getElementById("captcha-done-btn");

        const nnSlider = document.getElementById("nn-slider");
        const nnStatus = document.getElementById("nn-status");

        let selectedRating = null;
        let teaseClickCount = 0;
        let currentOffsetX = 0;
        let captchaSolved = false;
        let trainUnlocked = false;

        const commentsByRating = {
            1: "You've rated us a 1. An emergency meeting with the entire transit operations team has been scheduled. Please click 'OK' to begin the termination process for the train driver.",
            2: "A 2 star review means we are performing 40% below goal. Our metrics team is spiraling. Is your personal satisfaction worth destroying the morale of an entire department? Rethink this immediately.",
            3: "Ah, a 3. The mark of utter indifference. We will log this as 'Not Bad Enough to Fix.' Are you sure you don't have enough energy for just one more star? It requires minimal effort.",
            4: "FOUR stars is only 96% satisfaction! That small gap suggests a lack of alignment with our core brand values. Please detail the exact coordinates of the missing star before we can accept this submission.",
            5: "Perfect! Thank you. Now, to validate this 5-star rating, please complete a brief survey detailing 10 ways we can maintain this level of perfection forever. (This is mandatory, not optional.)"
        };

        const hoverCommentsByRating = {
            1: "1 star? The train just stalled emotionally.",
            2: "2 stars: minor derailment of happiness.",
            3: "3 stars: meh. The train shrugs.",
            4: "4 stars: so close the conductor can taste it.",
            5: "5 stars: the train is adding you to its will."
        };

        function updateSelection(rating) {
            selectedRating = rating;
            selectedRatingEl.textContent = rating;
            submitBtn.disabled = false;

            carriages.forEach(c => {
                const value = parseInt(c.getAttribute("data-rating"), 10);
                if (value === rating) c.classList.add("selected");
                else c.classList.remove("selected");
            });

            trainEl.className = "train rating-" + rating;
        }

        function moveTrainToRating(rating) {
            const ratingOffsets = { 1: -50, 2: -25, 3: 0, 4: 25, 5: 50 };
            const x = ratingOffsets[rating] || 0;
            currentOffsetX = x;
            trainEl.style.transform = `translate(${x}px, 0px) rotate(0deg)`;
        }

        function moveTrainDodge() {
            const possibleOffsets = [-110, -70, -30, 20, 60, 100];
            let bestOffset = possibleOffsets[0];
            let bestDist = Math.abs(bestOffset - currentOffsetX);

            possibleOffsets.forEach(off => {
                const dist = Math.abs(off - currentOffsetX);
                if (dist > bestDist + 10) {
                    bestDist = dist;
                    bestOffset = off;
                }
            });

            currentOffsetX = bestOffset;
            const angle = (Math.random() * 14 - 7);
            const y = (Math.random() * 10 - 5);

            trainEl.style.transform = `translate(${currentOffsetX}px, ${y}px) rotate(${angle}deg)`;
        }

        function showCaptcha() {
            captchaModal.classList.add("visible");
        }

        function hideCaptcha() {
            captchaModal.classList.remove("visible");
        }

        function evaluateCaptcha() {
            const tiles = Array.from(captchaTiles);
            const allGiftsSelected = tiles
                .filter(t => t.dataset.type === "gift")
                .every(t => t.classList.contains("selected"));
            const anyWrongSelected = tiles
                .filter(t => t.dataset.type !== "gift")
                .some(t => t.classList.contains("selected"));

            if (allGiftsSelected && !anyWrongSelected) {
                captchaSolved = true;
                captchaMessage.textContent = "Nice! Santa believes you. ‚úÖ";
            } else {
                captchaSolved = false;
                captchaMessage.textContent = "Tip: only click the presents, not the snowmen or trees.";
            }
        }

        captchaTiles.forEach(tile => {
            tile.addEventListener("click", () => {
                tile.classList.toggle("selected");
                evaluateCaptcha();
            });
        });

        captchaDoneBtn.addEventListener("click", () => {
            evaluateCaptcha();

            if (!robotCheckbox.checked) {
                captchaMessage.textContent = "Please tick ‚ÄúI'm not a robot‚Äù first.";
                return;
            }

            if (!captchaSolved) {
                return;
            }

            hideCaptcha();
        });

        // Naughty / Nice slider logic
        if (nnSlider) {
            nnSlider.addEventListener("input", () => {
                const v = parseInt(nnSlider.value, 10) || 0;
                if (v >= 80) {
                    trainUnlocked = true;
                    nnStatus.textContent = "Nice! The Holiday Express is unlocked.";
                } else {
                    trainUnlocked = false;
                    nnStatus.textContent = "Slide to ‚ÄúNice‚Äù to unlock the train.";
                }
            });
        }

        carriages.forEach(c => {
            c.addEventListener("click", () => {
                // Block rating until slider is on "Nice"
                if (!trainUnlocked) {
                    const rect = trainEl.getBoundingClientRect();
                    hoverTooltip.textContent = "The train only moves for Nice people. Slide the Naughty‚ÄìNice bar first.";
                    hoverTooltip.classList.add("visible");
                    hoverTooltip.style.left = rect.left + rect.width / 2 + "px";
                    hoverTooltip.style.top = rect.top - 20 + "px";
                    setTimeout(() => hoverTooltip.classList.remove("visible"), 1000);
                    return;
                }

                const rating = parseInt(c.getAttribute("data-rating"), 10);

                if (teaseClickCount < 3) {
                    teaseClickCount += 1;
                    moveTrainDodge();

                    hoverTooltip.textContent = `Attempt ${teaseClickCount}/3: The train has fled. Chase it!`;
                    hoverTooltip.classList.add("visible");

                    const rect = trainEl.getBoundingClientRect();
                    hoverTooltip.style.left = rect.left + rect.width / 2 + "px";
                    hoverTooltip.style.top = rect.top - 20 + "px";

                    setTimeout(() => hoverTooltip.classList.remove("visible"), 900);
                    return;
                }

                // 4th click: accept rating
                teaseClickCount = 0;
                updateSelection(rating);
                moveTrainToRating(rating);

                // After first successful rating selection, show captcha popup if not solved
                if (!captchaSolved) {
                    showCaptcha();
                }
            });

            c.addEventListener("mouseenter", (e) => {
                const rating = parseInt(c.getAttribute("data-rating"), 10);
                hoverTooltip.textContent = hoverCommentsByRating[rating];
                hoverTooltip.classList.add("visible");
                hoverTooltip.style.left = (e.clientX + 12) + "px";
                hoverTooltip.style.top = (e.clientY - 12) + "px";
            });

            c.addEventListener("mousemove", (e) => {
                hoverTooltip.style.left = (e.clientX + 12) + "px";
                hoverTooltip.style.top = (e.clientY - 12) + "px";
            });

            c.addEventListener("mouseleave", () => {
                hoverTooltip.classList.remove("visible");
            });
        });

        submitBtn.addEventListener("click", () => {
            if (!selectedRating) {
                alert("Please pick a rating first! The train needs to escape you 3 times before it cooperates üòà");
                return;
            }

            if (!captchaSolved) {
                showCaptcha();
                return;
            }

            const message = commentsByRating[selectedRating];
            const confirmed = confirm(
                message + "\n\nClick OK to lock in this rating, or Cancel to reconsider your life choices."
            );

            if (!confirmed) return;

            alert("Thanks! You successfully gave a " + selectedRating +
                "-star ride. The train will never forgive you.");
        });
    </script>
</body>
</html>
