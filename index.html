<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rate Your Train Ride</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(180deg, #9dd9ff 0%, #c9f1ff 40%, #f4f7fb 100%);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 10px 8px;
            overflow-x: hidden;
            position: relative;
            min-height: 350px; /* iframe height */
        }

        .widget-root {
            max-width: 460px;
            width: 100%;
            margin: 0 auto;
        }

        h1 {
            margin: 0 0 4px;
            font-size: 22px;
            text-align: center;
        }

        .subtitle {
            margin-bottom: 10px;
            color: #555;
            text-align: center;
            font-size: 12px;
            line-height: 1.4;
        }

        /* Clouds */
        .sky-cloud {
            position: fixed;
            top: 8%;
            width: 90px;
            height: 45px;
            background: #ffffff;
            border-radius: 60px;
            box-shadow:
                24px 8px 0 0 #ffffff,
                48px 4px 0 0 #ffffff;
            opacity: 0.9;
            z-index: -3;
            animation: cloud-drift 40s linear infinite;
        }
        .sky-cloud.cloud2 {
            top: 20%;
            width: 110px;
            animation-duration: 55s;
            animation-delay: -10s;
            opacity: 0.8;
        }
        .sky-cloud.cloud3 {
            top: 32%;
            width: 80px;
            animation-duration: 35s;
            animation-delay: -20s;
            opacity: 0.7;
        }
        @keyframes cloud-drift {
            0%   { transform: translateX(-20vw); }
            100% { transform: translateX(120vw); }
        }

        /* Santa flyover */
        .santa {
            position: fixed;
            top: 11%;
            right: -30%;
            width: 130px;
            height: 40px;
            pointer-events: none;
            z-index: 0;
            animation: santa-fly 18s linear infinite;
        }
        @keyframes santa-fly {
            0%   { transform: translateX(0); opacity: 0; }
            10%  { opacity: 1; }
            90%  { opacity: 1; }
            100% { transform: translateX(-90vw); opacity: 0; }
        }

        .santa-sleigh {
            position: absolute;
            right: 0;
            bottom: 6px;
            width: 42px;
            height: 15px;
            border-radius: 0 0 12px 12px;
            background: #b22222;
            box-shadow: 0 0 4px rgba(0,0,0,0.25);
        }
        .santa-sleigh::after {
            content: "";
            position: absolute;
            bottom: -4px;
            left: 4px;
            right: 4px;
            height: 3px;
            border-radius: 2px;
            background: #6b3a1d;
        }

        .santa-body {
            position: absolute;
            left: 6px;
            bottom: 10px;
            width: 16px;
            height: 16px;
            background: #e63946;
            border-radius: 6px 6px 4px 4px;
        }
        .santa-head {
            position: absolute;
            left: 9px;
            bottom: 24px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ffe0c2;
        }
        .santa-hat {
            position: absolute;
            left: 7px;
            bottom: 31px;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 3px solid transparent;
            border-bottom: 10px solid #e63946;
        }
        .santa-hat::after {
            content: "";
            position: absolute;
            right: -4px;
            bottom: -2px;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #fff;
        }

        .reindeer {
            position: absolute;
            right: 46px;
            bottom: 10px;
            width: 70px;
            height: 14px;
        }
        .reindeer-body {
            position: absolute;
            width: 16px;
            height: 12px;
            border-radius: 6px;
            background: #8b5a2b;
            box-shadow: 22px 0 0 #8b5a2b, 44px 0 0 #8b5a2b;
        }
        .reindeer-nose {
            position: absolute;
            left: -4px;
            top: 4px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #ff4b4b;
            box-shadow: 22px 0 0 #ffd93b, 44px 0 0 #ff4b4b;
        }

        /* Ground + trees */
        .ground {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(180deg, #76c26b 0%, #4e9e4a 100%);
            z-index: -1;
        }

        .bush {
            position: absolute;
            bottom: 18px;
            width: 60px;
            height: 26px;
            background: #3f8c3a;
            border-radius: 30px;
            box-shadow:
                18px 0 0 0 #3f8c3a,
                36px 0 0 0 #3f8c3a;
            opacity: 0.9;
        }
        .bush.b1 { left: 16%; }
        .bush.b2 { left: 44%; bottom: 22px; }
        .bush.b3 { left: 70%; }
        .bush.b4 { left: 84%; bottom: 24px; }

        .tree {
            position: absolute;
            bottom: 18px;
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 38px solid #1f7a3b;
        }
        .tree::before {
            content: "";
            position: absolute;
            left: -18px;
            top: -20px;
            border-left: 18px solid transparent;
            border-right: 18px solid transparent;
            border-bottom: 30px solid #24924a;
        }
        .tree-trunk {
            position: absolute;
            left: -5px;
            bottom: -10px;
            width: 10px;
            height: 10px;
            background: #5a3c20;
            border-radius: 2px;
        }
        .tree-lights {
            position: absolute;
            top: -12px;
            left: -18px;
            width: 36px;
            height: 34px;
            background:
                radial-gradient(circle, #ff4b4b 0 55%, transparent 60%) 4px 4px/10px 10px repeat,
                radial-gradient(circle, #ffd93b 0 55%, transparent 60%) 0px 14px/10px 10px repeat,
                radial-gradient(circle, #4be1ff 0 55%, transparent 60%) 8px 22px/10px 10px repeat;
            mix-blend-mode: screen;
            opacity: 0.8;
            animation: tree-blink 1.4s linear infinite;
        }
        .tree-star {
            position: absolute;
            top: -32px;
            left: -6px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: radial-gradient(circle, #ffd86b 0, #f3b136 60%, #c28c1a 100%);
            box-shadow: 0 0 6px rgba(255, 230, 150, 0.9);
        }
        .tree.t-left { left: 8%; transform: scale(0.95); }
        .tree.t-right { right: 8%; transform: scale(0.95); }

        @keyframes tree-blink {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .train-wrapper {
            margin: 6px 0 8px;
            position: relative;
            padding: 14px 18px 22px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.97);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            animation: gentle-bob 3s ease-in-out infinite;
        }
        @keyframes gentle-bob {
            0%   { transform: translateY(0); }
            50%  { transform: translateY(-2px); }
            100% { transform: translateY(0); }
        }

        .train-track-container {
            position: relative;
        }

        .train {
            position: relative;
            display: inline-block;
            transition: transform 0.3s ease;
            z-index: 1;
        }

        .train-image {
            display: block;
            width: 360px; /* tweak if your png is very different */
            height: auto;
        }

        .train-shadow {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 10px;
            height: 8px;
            background: radial-gradient(ellipse at center,
                rgba(0,0,0,0.18) 0,
                rgba(0,0,0,0.0) 70%);
            pointer-events: none;
        }

        /* Smoke on top of engine chimney */
        .smoke-stack {
            position: absolute;
            /* these coordinates assume the engine + chimney approx positions on train.png */
            top: -18px;
            left: 80px;
            width: 0;
            height: 0;
            z-index: 2;
        }
        .smoke-cloud {
            position: absolute;
            border-radius: 50%;
            background: rgba(220,220,220,0.9);
            animation: smoke-puff 2s ease-in-out infinite;
        }
        .smoke-cloud.one {
            width: 14px;
            height: 14px;
            top: -2px;
            left: -6px;
            animation-delay: 0s;
        }
        .smoke-cloud.two {
            width: 18px;
            height: 18px;
            top: -18px;
            left: -10px;
            animation-delay: 0.3s;
        }
        .smoke-cloud.three {
            width: 22px;
            height: 22px;
            top: -34px;
            left: -14px;
            animation-delay: 0.6s;
        }
        @keyframes smoke-puff {
            0% {
                transform: translateY(4px) scale(0.7);
                opacity: 0;
            }
            30% { opacity: 0.6; }
            70% {
                transform: translateY(-14px) scale(1);
                opacity: 0.9;
            }
            100% {
                transform: translateY(-24px) scale(1.1);
                opacity: 0;
            }
        }

        /* 5 invisible clickable rating zones over the train */
        .rating-zone {
            position: absolute;
            top: 8%;
            bottom: 8%;
            width: 20%;
            cursor: pointer;
        }
        .rating-zone[data-rating="1"] { left: 0%; }
        .rating-zone[data-rating="2"] { left: 20%; }
        .rating-zone[data-rating="3"] { left: 40%; }
        .rating-zone[data-rating="4"] { left: 60%; }
        .rating-zone[data-rating="5"] { left: 80%; }

        .rating-zone.selected {
            box-shadow: 0 0 0 2px rgba(255,255,255,0.9),
                        0 0 12px rgba(255,215,0,0.9);
            border-radius: 10px;
        }

        .track {
            width: 380px;
            height: 6px;
            background: #85552e;
            border-radius: 4px;
            margin-top: 20px;
            position: relative;
            box-shadow: inset 0 0 0 2px #5e3719;
        }
        .track::before {
            content: "";
            position: absolute;
            top: -8px;
            left: 0;
            right: 0;
            height: 16px;
            background-image: linear-gradient(
                to right,
                transparent 0 6px,
                #b8864b 6px 10px,
                transparent 10px 16px
            );
            background-size: 16px 16px;
            opacity: 0.9;
        }

        .rating-text {
            margin-top: 4px;
            font-size: 12px;
            text-align: center;
        }

        .controls {
            margin-top: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        button {
            padding: 6px 14px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            background: linear-gradient(135deg, #007bff, #00b4ff);
            color: #fff;
            box-shadow: 0 3px 8px rgba(0,0,0,0.25);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }
        button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.3);
        }
        button:disabled {
            background: #999;
            cursor: not-allowed;
            box-shadow: none;
        }

        .debug-note {
            margin-top: 4px;
            font-size: 10px;
            color: #777;
            text-align: center;
        }

        /* Tooltip */
        #hover-tooltip {
            position: fixed;
            padding: 6px 8px;
            background: #222;
            color: #fff;
            font-size: 11px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transform: translateY(-4px);
            transition: opacity 0.1s ease, transform 0.1s ease;
            max-width: 220px;
            z-index: 999;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        #hover-tooltip.visible {
            opacity: 1;
            transform: translateY(-8px);
        }
    </style>
</head>
<body>
    <!-- Clouds -->
    <div class="sky-cloud" style="left:-15%;"></div>
    <div class="sky-cloud cloud2" style="left:-30%;"></div>
    <div class="sky-cloud cloud3" style="left:-25%;"></div>

    <!-- Santa + reindeer -->
    <div class="santa">
        <div class="santa-sleigh">
            <div class="santa-body"></div>
            <div class="santa-head"></div>
            <div class="santa-hat"></div>
        </div>
        <div class="reindeer">
            <div class="reindeer-body"></div>
            <div class="reindeer-nose"></div>
        </div>
    </div>

    <!-- Ground + trees -->
    <div class="ground">
        <div class="bush b1"></div>
        <div class="bush b2"></div>
        <div class="bush b3"></div>
        <div class="bush b4"></div>

        <div class="tree t-left">
            <div class="tree-trunk"></div>
            <div class="tree-lights"></div>
            <div class="tree-star"></div>
        </div>
        <div class="tree t-right">
            <div class="tree-trunk"></div>
            <div class="tree-lights"></div>
            <div class="tree-star"></div>
        </div>
    </div>

    <div class="widget-root">
        <h1>Rate Your Train Ride</h1>
        <div class="subtitle">
            Move your mouse over the train and click a carriage (1â€“5).<br />
            The sky is calm. The train is not.
        </div>

        <div class="train-wrapper">
            <div class="train-track-container">
                <div class="train-shadow"></div>

                <!-- TRAIN: single image + smoke + rating zones -->
                <div id="train" class="train rating-0">
                    <img src="train.png" alt="Christmas train" class="train-image" />

                    <!-- smoke above chimney -->
                    <div class="smoke-stack">
                        <div class="smoke-cloud one"></div>
                        <div class="smoke-cloud two"></div>
                        <div class="smoke-cloud three"></div>
                    </div>

                    <!-- invisible clickable rating zones -->
                    <div class="rating-zone" data-rating="1"></div>
                    <div class="rating-zone" data-rating="2"></div>
                    <div class="rating-zone" data-rating="3"></div>
                    <div class="rating-zone" data-rating="4"></div>
                    <div class="rating-zone" data-rating="5"></div>
                </div>

                <div class="track"></div>
            </div>
        </div>

        <div class="controls">
            <div class="rating-text">
                Selected rating:
                <strong id="selected-rating">None</strong> (out of 5)
            </div>
            <button id="submit-btn" disabled>Submit Rating</button>
        </div>

        <div class="debug-note">
            Warning: side effects may include guilt, laughter, and sudden empathy for trains.
        </div>
    </div>

    <div id="hover-tooltip"></div>

    <script>
        const trainEl = document.getElementById("train");
        const ratingZones = document.querySelectorAll(".rating-zone");
        const selectedRatingEl = document.getElementById("selected-rating");
        const submitBtn = document.getElementById("submit-btn");
        const hoverTooltip = document.getElementById("hover-tooltip");

        let selectedRating = null;
        let teaseClickCount = 0;
        let currentOffsetX = 0;

        const commentsByRating = {
            1: "You've rated us a 1. An emergency meeting with the entire transit operations team has been scheduled. Please click 'OK' to begin the termination process for the train driver.",
            2: "A 2 star review means we are performing 40% below goal. Our metrics team is spiraling. Is your personal satisfaction worth destroying the morale of an entire department? Rethink this immediately.",
            3: "Ah, a 3. The mark of utter indifference. We will log this as 'Not Bad Enough to Fix.' Are you sure you don't have enough energy for just one more star? It requires minimal effort.",
            4: "FOUR stars is only 96% satisfaction! That small gap suggests a lack of alignment with our core brand values. Please detail the exact coordinates of the missing star before we can accept this submission.",
            5: "Perfect! Thank you. Now, to validate this 5-star rating, please complete a brief survey detailing 10 ways we can maintain this level of perfection forever. (This is mandatory, not optional.)"
        };

        const hoverCommentsByRating = {
            1: "1 star? The train just stalled emotionally.",
            2: "2 stars: minor derailment of happiness.",
            3: "3 stars: meh. The train shrugs.",
            4: "4 stars: so close the conductor can taste it.",
            5: "5 stars: the train is adding you to its will."
        };

        function updateSelection(rating) {
            selectedRating = rating;
            selectedRatingEl.textContent = rating;
            submitBtn.disabled = false;

            ratingZones.forEach(z => {
                const value = parseInt(z.getAttribute("data-rating"), 10);
                if (value === rating) z.classList.add("selected");
                else z.classList.remove("selected");
            });
        }

        function moveTrainToRating(rating) {
            const ratingOffsets = { 1: -50, 2: -25, 3: 0, 4: 25, 5: 50 };
            const x = ratingOffsets[rating] || 0;
            currentOffsetX = x;
            trainEl.style.transform = `translate(${x}px, 0px) rotate(0deg)`;
        }

        function moveTrainDodge() {
            const possibleOffsets = [-110, -70, -30, 20, 60, 100];
            let bestOffset = possibleOffsets[0];
            let bestDist = Math.abs(bestOffset - currentOffsetX);

            possibleOffsets.forEach(off => {
                const dist = Math.abs(off - currentOffsetX);
                if (dist > bestDist + 10) {
                    bestDist = dist;
                    bestOffset = off;
                }
            });

            currentOffsetX = bestOffset;
            const angle = (Math.random() * 14 - 7);
            const y = (Math.random() * 10 - 5);

            trainEl.style.transform = `translate(${currentOffsetX}px, ${y}px) rotate(${angle}deg)`;
        }

        ratingZones.forEach(z => {
            z.addEventListener("click", () => {
                const rating = parseInt(z.getAttribute("data-rating"), 10);

                if (teaseClickCount < 3) {
                    teaseClickCount += 1;
                    moveTrainDodge();

                    hoverTooltip.textContent = `Attempt ${teaseClickCount}/3: The train has fled. Chase it!`;
                    hoverTooltip.classList.add("visible");

                    const rect = trainEl.getBoundingClientRect();
                    hoverTooltip.style.left = rect.left + rect.width / 2 + "px";
                    hoverTooltip.style.top = rect.top - 20 + "px";

                    setTimeout(() => hoverTooltip.classList.remove("visible"), 900);
                    return;
                }

                // 4th click: accept rating
                teaseClickCount = 0;
                updateSelection(rating);
                moveTrainToRating(rating);
            });

            z.addEventListener("mouseenter", (e) => {
                const rating = parseInt(z.getAttribute("data-rating"), 10);
                hoverTooltip.textContent = hoverCommentsByRating[rating];
                hoverTooltip.classList.add("visible");
                hoverTooltip.style.left = (e.clientX + 12) + "px";
                hoverTooltip.style.top = (e.clientY - 12) + "px";
            });

            z.addEventListener("mousemove", (e) => {
                hoverTooltip.style.left = (e.clientX + 12) + "px";
                hoverTooltip.style.top = (e.clientY - 12) + "px";
            });

            z.addEventListener("mouseleave", () => {
                hoverTooltip.classList.remove("visible");
            });
        });

        submitBtn.addEventListener("click", () => {
            if (!selectedRating) {
                alert("Please pick a rating first! The train needs to escape you 3 times before it cooperates ðŸ˜ˆ");
                return;
            }

            const message = commentsByRating[selectedRating];
            const confirmed = confirm(
                message + "\n\nClick OK to lock in this rating, or Cancel to reconsider your life choices."
            );

            if (!confirmed) return;

            alert("Thanks! You successfully gave a " + selectedRating +
                "-star ride. The train will never forgive you.");
        });
    </script>
</body>
</html>
